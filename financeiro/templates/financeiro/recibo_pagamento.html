{% extends "base.html" %}
{% load static %}

{% block title %}Recibo de Pagamento #{{ pagamento.id }} - Pousada Pajeú{% endblock %}

{% block extra_css %}
<style>
    @media print {
        .no-print {
            display: none;
        }
        body {
            font-size: 12pt;
            color: #000;
            background-color: #fff;
        }
        .container {
            width: 100%;
            max-width: 100%;
            padding: 0;
            margin: 0;
        }
        .recibo-container {
            border: 1px solid #000;
            padding: 20px;
            margin-bottom: 20px;
        }
        .recibo-header {
            border-bottom: 2px solid #000;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .recibo-footer {
            border-top: 1px solid #000;
            margin-top: 20px;
            padding-top: 10px;
        }
    }
    
    .recibo-container {
        border: 1px solid #ddd;
        padding: 20px;
        margin-bottom: 20px;
        background-color: #fff;
    }
    .recibo-header {
        border-bottom: 2px solid #007bff;
        margin-bottom: 20px;
        padding-bottom: 10px;
    }
    .recibo-footer {
        border-top: 1px solid #ddd;
        margin-top: 20px;
        padding-top: 10px;
        font-size: 0.9em;
    }
    .marca-dagua {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-45deg);
        font-size: 100px;
        opacity: 0.05;
        color: #007bff;
        z-index: 1;
        pointer-events: none;
    }
    .recibo-content {
        position: relative;
        z-index: 2;
    }
    .recibo-numero {
        font-size: 1.2em;
        font-weight: bold;
        color: #007bff;
    }
    .valor-destaque {
        font-size: 1.4em;
        font-weight: bold;
        color: #28a745;
    }
    .qr-code {
        width: 100px;
        height: 100px;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: auto;
    }
    .recibo-status {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 3px;
        font-weight: bold;
        margin-left: 10px;
    }
    .status-aprovado {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .status-estornado {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    .autenticacao {
        font-size: 0.8em;
        margin-top: 10px;
        color: #6c757d;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="mb-3 no-print">
        <button onclick="window.print()" class="btn btn-primary">
            <i class="fas fa-print"></i> Imprimir Recibo
        </button>
        <a href="{% url 'financeiro:pagamento_detalhe' pagamento.id %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
    </div>
    
    <div class="recibo-container position-relative">
        <div class="marca-dagua">
            {% if pagamento.status == 'aprovado' %}
                PAGO
            {% elif pagamento.status == 'estornado' %}
                ESTORNADO
            {% else %}
                POUSADA PAJEÚ
            {% endif %}
        </div>
        
        <div class="recibo-content">
            <div class="recibo-header d-flex justify-content-between align-items-center">
                <div>
                    <img src="{% static 'img/logo.png' %}" alt="Logo Pousada Pajeú" height="60" onerror="this.src='https://via.placeholder.com/180x60?text=Pousada+Pajeú'; this.onerror=null;">
                    <h5 class="mt-2 mb-0">{{ empresa.nome }}</h5>
                    <div class="small text-muted">CNPJ: {{ empresa.cnpj }}</div>
                </div>
                <div class="text-end">
                    <div class="recibo-numero">RECIBO DE PAGAMENTO Nº {{ pagamento.id }}</div>
                    <div class="mt-1">Data de Emissão: {{ data_emissao|date:"d/m/Y H:i" }}</div>
                    <div class="mt-1">
                        Status: 
                        <span class="recibo-status {% if pagamento.status == 'aprovado' %}status-aprovado{% elif pagamento.status == 'estornado' %}status-estornado{% endif %}">
                            {{ pagamento.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <h5>Dados do Cliente</h5>
                    {% if pagamento.reserva %}
                        <div><strong>Nome:</strong> {{ pagamento.reserva.hospede.nome }}</div>
                        <div><strong>Documento:</strong> {{ pagamento.reserva.hospede.documento }}</div>
                        <div><strong>Email:</strong> {{ pagamento.reserva.hospede.email }}</div>
                        <div><strong>Telefone:</strong> {{ pagamento.reserva.hospede.telefone }}</div>
                    {% else %}
                        <div class="text-muted">Cliente não vinculado a uma reserva</div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <div class="qr-code">
                        <!-- Simulação de QR Code -->
                        <div class="text-center text-muted small">
                            <i class="fas fa-qrcode fa-3x mb-2"></i>
                            <div>QR Code</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <h5>Detalhes do Pagamento</h5>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tr>
                            <th style="width: 30%">Descrição</th>
                            <td>
                                {% if pagamento.reserva %}
                                    Pagamento referente à reserva #{{ pagamento.reserva.id }} -
                                    Check-in: {{ pagamento.reserva.check_in|date:"d/m/Y" }} | 
                                    Check-out: {{ pagamento.reserva.check_out|date:"d/m/Y" }}
                                {% else %}
                                    Pagamento #{{ pagamento.id }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>Forma de Pagamento</th>
                            <td>{{ pagamento.get_tipo_display }}</td>
                        </tr>
                        <tr>
                            <th>Data do Pagamento</th>
                            <td>{{ pagamento.data_pagamento|date:"d/m/Y H:i" }}</td>
                        </tr>
                        <tr>
                            <th>Valor</th>
                            <td class="valor-destaque">R$ {{ pagamento.valor|floatformat:2 }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            {% if pagamento.observacoes %}
            <div class="mt-3">
                <h5>Observações</h5>
                <div class="p-2 bg-light border">
                    {{ pagamento.observacoes|linebreaks }}
                </div>
            </div>
            {% endif %}
            
            <div class="recibo-footer d-flex justify-content-between align-items-center">
                <div>
                    <div>{{ empresa.endereco }}</div>
                    <div>{{ empresa.cidade }}/{{ empresa.estado }}</div>
                    <div>{{ empresa.telefone }} | {{ empresa.email }}</div>
                    <div class="autenticacao">
                        Código de Autenticação: {{ pagamento.id|stringformat:"06d" }}-{{ data_emissao|date:"Ymd" }}-{{ pagamento.valor|floatformat:2|cut:"." }}
                    </div>
                </div>
                <div class="text-end">
                    <div class="mt-4 pt-2 border-top">
                        <div>_______________________________</div>
                        <div>Assinatura Autorizada</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="text-center mt-3 small text-muted no-print">
        <p>Este recibo é válido como comprovante de pagamento.</p>
        <p>Em caso de dúvidas, entre em contato conosco pelo telefone {{ empresa.telefone }} ou e-mail {{ empresa.email }}.</p>
    </div>
</div>
{% endblock %} 